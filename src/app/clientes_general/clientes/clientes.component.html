<!-- NavegaciÃ³n superior -->
<nav class="bg-white shadow flex justify-between items-center p-4">
    <div class="flex items-center">
      <img src="/img/icon.png" alt="logo" class="h-8 mr-2" />
      <h1 class="text-xl font-bold text-red-500">Clientes</h1>
    </div>
    <h2 class="text-xl font-bold text-red-500">Vista General</h2>
    <h2 class="text-xl font-bold text-red-500">Supermercado "LABRYC" CIA LTDA</h2>
    <div class="flex items-center space-x-4">
      <span class="text-red-500 cursor-pointer">ğŸ””</span>
      <span id="menu-toggle" class="text-red-500 cursor-pointer">â˜¶</span>
      <span class="text-red-500 cursor-pointer">ğŸ </span>
      <span class="text-red-500 cursor-pointer">â„¹ï¸</span>
      <img src="/img/user.png" alt="Usuario" class="h-8 w-8 rounded-full" />
    </div>
  </nav>
  
  <!-- Contenedor principal con ambos menÃºs y contenido -->
  <div class="billing-admin-container">
    <!-- MenÃº de AdministraciÃ³n (Colapsable) -->
    <aside class="admin-menu" [class.collapsed]="isAdminMenuCollapsed">
      <ul class="menu">
        <li class="menu-item admin" (click)="navigateTo('administracion')">
          âš™ï¸ <span>AdministraciÃ³n</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Productos')">
          ğŸ“¦ <span>Productos</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Proveedores')">
          ğŸšš <span>Proveedores</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Tipos PVP')">
          ğŸ’° <span>Tipos PVP</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Clientes')">
          ğŸ‘¥ <span>Clientes</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Cuentas Contables')">
          ğŸ“‘ <span>Cuentas Contables</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Empresa')">
          ğŸ¢ <span>Empresa</span>
        </li>
        <li class="menu-item" (click)="navigateTo('ConfiguraciÃ³n')">
          ğŸ”§ <span>ConfiguraciÃ³n</span>
        </li>
      </ul>
      <div class="footer">
        <span>Â© 2024 Punto Pymes CIA</span>
        <button class="toggle-admin-menu" (click)="toggleAdminMenu()">âª</button>
      </div>
    </aside>
  
    <!-- MenÃº Principal (Izquierda) -->
    <aside class="side-menu">
      <ul class="menu">
        <li class="menu-item" (click)="navigateTo('Clientes')"   
        [ngClass]="{ active: isActive('Clientes') }">
          ğŸ“ˆ <span>Vista General</span>
        </li>
        <li class="menu-item" (click)="navigateTo('Tipos de clientes')">
          ğŸš› <span>Tipos Clientes</span>
        </li>
      </ul>
    </aside>
  
    <!-- Contenido Principal -->
    <main class="main-content">
      <!-- Barra de navegaciÃ³n superior ubicaciÃ³n del usuario (breadcrumb) -->
      <div class="breadcrumb-container">
        <a (click)="navigateTo('Clientes')" class="breadcrumb-link">Clientes</a>
        /
        <span class="breadcrumb-current">Vista General</span>
      </div>
  
      <!-- Barra de bÃºsqueda con selector de filtro y botones adicionales -->
      <div class="search-container">
        <select
          id="search-type"
          [(ngModel)]="searchType"
          (change)="cambiarTipoBusqueda()"
        >
          <option value="cedula">C.I / RUC</option>
          <option value="nombre">Nombre</option>
          <option value="codigo">CÃ³digo</option>
        </select>
  
        <input
          type="search"
          id="search-input"
          [(ngModel)]="searchValue"
          (input)="actualizarListaClientes()"
          placeholder="Buscar cliente..."
        />
        <button class="search-btn" (click)="actualizarListaClientes()">ğŸ”</button>
  
        <div style="position: relative">
          <button class="column-toggle" (click)="toggleColumnas()">ğŸ“Š</button>
          <div class="column-selector" [class.hidden]="!mostrarColumnas">
            <div class="column-list">
              <label *ngFor="let columna of columnasDisponibles">
                <input
                  type="checkbox"
                  [(ngModel)]="columna.selected"
                  (change)="actualizarColumnas()"
                />
                {{ columna.name }}
              </label>
            </div>
          </div>
        </div>
  
        <button class="btn-export" (click)="exportarExcel()">ğŸ“¥ Excel</button>
        <button class="btn-import" (click)="navigateTo('Importar')">
          ğŸ“‚ Importar
        </button>
        <button class="btn-new-product" (click)="agregarCliente()">
          â• Agregar Cliente
        </button>
      </div>
  
      <!-- Tabla de Clientes -->
      <table class="product-table" *ngIf="!mostrarFormularioEdicion">
        <thead>
          <tr>
            <th *ngFor="let columna of columnasVisibles">{{ columna.name }}</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientesFiltrados">
            <td *ngFor="let columna of columnasVisibles">
              {{ cliente[columna.key] }}
            </td>
            <td>
              <button class="btn-edit" (click)="editarCliente(cliente)">
                âœï¸
              </button>
              <button class="btn-delete" (click)="abrirModalEliminar(cliente)">
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
        </tbody>
      </table>
  
      <!-- PaginaciÃ³n -->
      <div class="pagination">
        <button
          (click)="cambiarPagina(paginaActual - 1)"
          [disabled]="paginaActual === 1"
        >
          Previa
        </button>
        <span
          >Mostrando del {{ (paginaActual - 1) * itemsPorPagina + 1 }} al
          {{ Math.min(paginaActual * itemsPorPagina, totalRegistros) }} registros
          de {{ totalRegistros }}</span
        >
        <button
          (click)="cambiarPagina(paginaActual + 1)"
          [disabled]="paginaActual * itemsPorPagina >= totalRegistros"
        >
          Siguiente
        </button>
      </div>
  
      <!-- Modal para eliminar cliente -->
      <div class="modal-overlay" *ngIf="mostrarModalEliminar">
        <div class="modal-eliminar">
          <h2>Eliminar Cliente</h2>
          <p>Â¿EstÃ¡s seguro de que deseas eliminar este cliente?</p>
          <strong>{{ clienteAEliminar?.nombres }}</strong>
          <p>
            Esta acciÃ³n harÃ¡ que el cliente ya no estÃ© disponible ni visible en el
            sistema.
          </p>
          <div class="modal-buttons">
            <button class="btn-cancel" (click)="cerrarModalEliminar()">
              Cancelar
            </button>
            <button class="btn-delete-confirm" (click)="eliminarCliente()">
              Eliminar Cliente
            </button>
          </div>
        </div>
      </div>
  
      <!-- Modal para el formulario de ediciÃ³n/creaciÃ³n -->
      <div class="modal-overlay" *ngIf="mostrarFormularioEdicion">
        <div class="modal-formulario">
          <span class="close" (click)="cancelarEdicion()">&times;</span>
          <div class="formulario-edicion">
            <h2>{{ esEdicion ? "Editar Cliente" : "Agregar Cliente" }}</h2>
            <form (ngSubmit)="guardarCliente()">
              <!-- 1. InformaciÃ³n BÃ¡sica -->
              <fieldset>
                <legend>InformaciÃ³n BÃ¡sica</legend>
                <div class="form-group">
                  <label>Tipo de Documento</label>
                  <select
                    [(ngModel)]="clienteSeleccionado.tipoDocumento"
                    name="tipoDocumento"
                    required
                  >
                    <option value="CI/RUC">CI/RUC</option>
                    <option value="Pasaporte">Pasaporte</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Sujeto</label>
                  <select
                    [(ngModel)]="clienteSeleccionado.sujeto"
                    name="sujeto"
                    required
                  >
                    <option value="Natural">Natural</option>
                    <option value="JurÃ­dica">JurÃ­dica</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>IdentificaciÃ³n</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.identificacion"
                    name="identificacion"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Nombres</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.nombres"
                    name="nombres"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Apellidos</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.apellidos"
                    name="apellidos"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>DirecciÃ³n</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.direccion"
                    name="direccion"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Tipo de Cliente</label>
                  <select
                    [(ngModel)]="clienteSeleccionado.tipoCliente"
                    name="tipoCliente"
                    required
                  >
                    <option *ngFor="let tipo of tiposCliente" [value]="tipo">
                      {{ tipo }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label>TelÃ©fono</label>
                  <input
                    type="tel"
                    [(ngModel)]="clienteSeleccionado.telefono"
                    name="telefono"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Correo ElectrÃ³nico</label>
                  <input
                    type="email"
                    [(ngModel)]="clienteSeleccionado.correo"
                    name="correo"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Correo ElectrÃ³nico 2</label>
                  <input
                    type="email"
                    [(ngModel)]="clienteSeleccionado.correo2"
                    name="correo2"
                  />
                </div>
              </fieldset>
  
              <!-- 2. Datos de FacturaciÃ³n -->
              <fieldset>
                <legend>Datos de FacturaciÃ³n</legend>
                <div class="form-group">
                  <label>RazÃ³n Social</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.razonSocial"
                    name="razonSocial"
                  />
                </div>
                <div class="form-group">
                  <label>Establecimiento</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.establecimiento"
                    name="establecimiento"
                  />
                </div>
                <div class="form-group">
                  <label>Documento</label>
                  <select
                    [(ngModel)]="clienteSeleccionado.documento"
                    name="documento"
                  >
                    <option value="Factura">Factura</option>
                    <option value="Nota de Venta">Nota de Venta</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>AutorizaciÃ³n del SRI</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.autorizacionSRI"
                    name="autorizacionSRI"
                  />
                </div>
                <div class="form-group">
                  <label>Punto de EmisiÃ³n</label>
                  <input
                    type="text"
                    [(ngModel)]="clienteSeleccionado.puntoEmision"
                    name="puntoEmision"
                  />
                </div>
                <div class="form-group">
                  <label>Fecha de Caducidad</label>
                  <input
                    type="date"
                    [(ngModel)]="clienteSeleccionado.fechaCaducidad"
                    name="fechaCaducidad"
                  />
                </div>
              </fieldset>
  
              <!-- 3. Datos Extras -->
              <fieldset>
                <legend>Datos Extras</legend>
                <div class="form-group">
                  <label>Ingresos Mensuales</label>
                  <input
                    type="number"
                    [(ngModel)]="clienteSeleccionado.ingresosMensuales"
                    name="ingresosMensuales"
                  />
                </div>
                <div class="form-group">
                  <label>Ciudad</label>
                  <select [(ngModel)]="clienteSeleccionado.ciudad" name="ciudad">
                    <option *ngFor="let ciudad of ciudades" [value]="ciudad">
                      {{ ciudad }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label>CantÃ³n</label>
                  <select [(ngModel)]="clienteSeleccionado.canton" name="canton">
                    <option *ngFor="let canton of cantones" [value]="canton">
                      {{ canton }}
                    </option>
                  </select>
                </div>
              </fieldset>
  
              <!-- 4. Retenciones -->
              <fieldset>
                <legend>Retenciones</legend>
  
                <!-- Barra de bÃºsqueda de retenciones -->
                <div class="retenciones-search">
                  <input
                    type="text"
                    placeholder="Buscar retenciÃ³n..."
                    [(ngModel)]="busquedaRetencion"
                    name="busquedaRetencion"
                    (input)="buscarRetencion()"
                  />
                  <button type="button" (click)="buscarRetencion()">
                    ğŸ” Buscar
                  </button>
                </div>
  
                <!-- Lista de retenciones disponibles -->
                <div class="retenciones-list">
                  <label>Lista de Retenciones Disponibles</label>
                  <ul>
                    <li *ngFor="let retencion of retencionesFiltradas">
                      {{ retencion.codigo }} - {{ retencion.descripcion }}
                      <button type="button" (click)="agregarRetencion(retencion)">
                        â• Agregar
                      </button>
                    </li>
                  </ul>
                </div>
  
                <!-- Lista de retenciones agregadas -->
                <div class="retenciones-list">
                  <label>Retenciones Agregadas</label>
                  <ul>
                    <li *ngFor="let retencion of clienteSeleccionado.retenciones">
                      {{ retencion.codigo }} - {{ retencion.descripcion }}
                      <button type="button" (click)="quitarRetencion(retencion)">
                        â– Quitar
                      </button>
                    </li>
                  </ul>
                </div>
  
                <!-- Botones de acciÃ³n -->
                <div class="retenciones-actions">
                  <button type="button" (click)="pasarTodos()">
                    Pasar Todos
                  </button>
                  <button type="button" (click)="quitarTodos()">
                    Quitar Todos
                  </button>
                </div>
              </fieldset>
  
              <!-- Botones de AcciÃ³n -->
              <div class="form-actions">
                <button
                  type="button"
                  class="btn-cancel"
                  (click)="cancelarEdicion()"
                >
                  âŒ Cancelar
                </button>
                <button type="submit" class="btn-save">
                  {{ esEdicion ? "ğŸ’¾ Guardar Cambios" : "âœ… Crear Cliente" }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>
  </div>