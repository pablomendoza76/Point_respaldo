<!-- Navegaci√≥n superior -->
<nav class="bg-white shadow flex justify-between items-center p-4">
  <div class="flex items-center">
    <img src="/img/icon.png" alt="logo" class="h-8 mr-2">
    <h1>Productos</h1>
  </div>
  <h2>Vista General</h2>
  <h2 class="text-xl font-bold text-red-500">Supermercado "LABRYC" CIA LTDA</h2>
  <div class="flex items-center space-x-4">
    <span class="text-red-500 cursor-pointer">üîî</span>
    <span id="menu-toggle" class="text-red-500 cursor-pointer">üî≥</span>
    <span class="text-red-500 cursor-pointer">üè†</span>
    <span class="text-red-500 cursor-pointer">‚ÑπÔ∏è</span>
    <img src="/img/user.png" alt="Usuario" class="h-8 w-8 rounded-full">
  </div>
</nav>

<!-- Contenedor principal con ambos men√∫s y contenido -->
<div class="billing-admin-container">
  <!-- Men√∫ de Administraci√≥n (Colapsable) -->
  <aside class="admin-menu" [class.collapsed]="isAdminMenuCollapsed">
    <ul class="menu">
      <li class="menu-item admin" (click)="navigateTo('administracion')">‚öôÔ∏è <span>Administraci√≥n</span></li>
      <li class="menu-item" (click)="navigateTo('Productos')" 
      [ngClass]="{ active: isActive('Productos') }">üì¶ <span>Productos</span></li>
      <li class="menu-item" (click)="navigateTo('Proveedores')">üöö <span>Proveedores</span></li>
      <li class="menu-item" (click)="navigateTo('Tipos PVP')">üí∞ <span>Tipos PVP</span></li>
      <li class="menu-item" (click)="navigateTo('Clientes')">üë• <span>Clientes</span></li>
      <li class="menu-item" (click)="navigateTo('Cuentas Contables')">üìë <span>Cuentas Contables</span></li>
      <li class="menu-item" (click)="navigateTo('Empresa')">üè¢ <span>Empresa</span></li>
      <li class="menu-item" (click)="navigateTo('Configuraci√≥n')">üîß <span>Configuraci√≥n</span></li>
    </ul>
    <div class="footer">
      <span>¬© 2024 Punto Pymes CIA</span>
      <button class="toggle-admin-menu" (click)="toggleAdminMenu()">‚è™</button>
    </div>
  </aside>

  <!-- Men√∫ Principal (Izquierda) -->
  <aside class="side-menu">
    <ul class="menu">
      <li class="menu-item" (click)="navigateTo('Productos')" 
      [ngClass]="{ active: isActive('Productos') }">üìà <span>Vista General</span></li>
      <li class="menu-item" (click)="navigateTo('Marcas')">üè∑Ô∏è <span>Marcas</span></li>
      <li class="menu-item" (click)="navigateTo('Tipos de Productos')">üì¶ <span>Tipos de Productos</span></li>
      <li class="menu-item" (click)="navigateTo('Tarifas por Grupo')">üí≤ <span>Tarifas por Grupo</span></li>
    </ul>
  </aside>

  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Barra de navegaci√≥n superior ubicaci√≥n del usuario (breadcrumb) -->
    <div class="breadcrumb-container">
      <a (click)="navigateTo('Productos')" class="breadcrumb-link">Productos</a> /
      <span class="breadcrumb-current">Vista General</span>
    </div>

    <!-- Barra de b√∫squeda con selector de filtro y botones adicionales -->
    <div class="search-container">
      <select id="search-type" [(ngModel)]="searchType" (change)="cambiarTipoBusqueda()">
        <option value="codigo">Cod. Com√∫n</option>
        <option value="nombre">Nombre</option>
        <option value="codigo1">Cod. de Barras 1</option>
        <option value="codigo2">Cod. de Barras 2</option>
        <option value="codigo3">Cod. de Barras 3</option>
      </select>

      <input type="search" id="search-input" [(ngModel)]="searchValue" (input)="actualizarListaProductos()" placeholder="Buscar producto...">
      <button class="search-btn" (click)="actualizarListaProductos()">üîé</button>
     <!-- Bot√≥n para mostrar/ocultar filtros -->
<button class="filter-toggle" (click)="toggleFiltros()">üîΩ</button>

      <div style="position: relative;">
        <button class="column-toggle" (click)="toggleColumnas()">üìä</button>
        <div class="column-selector" [class.hidden]="!mostrarColumnas">
          <div class="column-list">
            <label *ngFor="let columna of columnasDisponibles">
              <input type="checkbox" [(ngModel)]="columna.selected" (change)="actualizarColumnas()"> {{ columna.name }}
            </label>
          </div>
        </div>
      </div>

      <button class="btn-export" (click)="exportarExcel()">üì• Excel</button>
      <button class="btn-import" (click)="navigateTo('Importar')">üìÇ Importar</button>
      <button class="btn-new-product" (click)="agregarProducto()">‚ûï Agregar Producto</button>
    </div>

    <!-- Secci√≥n de filtros -->
<div class="filter-section" [class.hidden]="!mostrarFiltros">
  <select [(ngModel)]="filtroGrupo" (change)="actualizarListaProductos()">
    <option value="">Todos los Grupos</option>
    <option *ngFor="let grupo of grupos" [value]="grupo">{{ grupo }}</option>
</select>

<select [(ngModel)]="filtroMarca" (change)="actualizarListaProductos()">
    <option value="">Todas las Marcas</option>
    <option *ngFor="let marca of marcas" [value]="marca">{{ marca }}</option>
</select>

  <div class="filter-buttons">
    <button class="filter-btn" (click)="aplicarFiltros('todos')" [class.active]="filtroActivo === 'todos'">Todos</button>
    <button class="filter-btn" (click)="aplicarFiltros('stock')" [class.active]="filtroActivo === 'stock'">Stock</button>
    <button class="filter-btn" (click)="aplicarFiltros('medio')" [class.active]="filtroActivo === 'medio'">Medio</button>
    <button class="filter-btn" (click)="aplicarFiltros('sin_stock')" [class.active]="filtroActivo === 'sin_stock'">Sin Stock</button>
  </div>
</div>

    <!-- Tabla de Productos -->
    <table class="product-table" *ngIf="!mostrarFormularioEdicion">
      <thead>
        <tr>
          <th *ngFor="let columna of columnasVisibles">{{ columna.name }}</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let producto of productosFiltrados">
          <td *ngFor="let columna of columnasVisibles">{{ producto[columna.key] }}</td>
          <td>
            <button class="btn-edit" (click)="editarProducto(producto)">‚úèÔ∏è</button>
            <button class="btn-delete" (click)="abrirModalEliminar(producto)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Paginaci√≥n -->
    <div class="pagination">
      <button (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 1">Previa</button>
      <span>Mostrando del {{ (paginaActual - 1) * itemsPorPagina + 1 }} al {{ Math.min(paginaActual * itemsPorPagina, totalRegistros) }} registros de {{ totalRegistros }}</span>
      <button (click)="cambiarPagina(paginaActual + 1)" [disabled]="paginaActual * itemsPorPagina >= totalRegistros">Siguiente</button>
    </div>

    <!-- Modal de eliminaci√≥n -->
    <div class="modal-overlay" *ngIf="mostrarModalEliminar">
      <div class="modal-eliminar">
        <h2>Eliminar Producto</h2>
        <p>¬øEst√°s seguro de que deseas eliminar este producto?</p>
        <strong>{{ productoAEliminar?.nombre }}</strong>
        <p>Esta acci√≥n har√° que el producto ya no est√© disponible ni visible en el sistema.</p>
        <div class="modal-buttons">
          <button class="btn-cancel" (click)="cerrarModalEliminar()">Cancelar</button>
          <button class="btn-delete-confirm" (click)="eliminarProducto()">Eliminar Producto</button>
        </div>
      </div>
    </div>

    <!-- Modal para el formulario de edici√≥n/creaci√≥n -->
    <div class="modal-overlay" *ngIf="mostrarFormularioEdicion">
      <div class="modal-formulario">
        <span class="close" (click)="cancelarEdicion()">&times;</span>
        <div class="formulario-edicion">
          <h2>{{ esEdicion ? 'Editar Producto' : 'Agregar Producto' }}</h2>
          <form (ngSubmit)="guardarProducto()">
            <!-- 1. Informaci√≥n B√°sica -->
            <fieldset>
              <legend>Informaci√≥n B√°sica</legend>
              <div class="form-group">
                <label>Nombre</label>
                <input type="text" [(ngModel)]="productoSeleccionado.nombre" name="nombre" required>
              </div>
              <div class="form-group">
                <label>Descripci√≥n</label>
                <input type="text" [(ngModel)]="productoSeleccionado.descripcion" name="descripcion">
              </div>
              <div class="form-group">
                <label>Tipo de Producto</label>
                <select [(ngModel)]="productoSeleccionado.tipo" name="tipo">
                  <option *ngFor="let tipo of tiposProducto" [value]="tipo">{{ tipo }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Grupo</label>
                <select [(ngModel)]="productoSeleccionado.grupo" name="grupo">
                  <option *ngFor="let grupo of grupos" [value]="grupo">{{ grupo }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Sub Grupo</label>
                <select [(ngModel)]="productoSeleccionado.subGrupo" name="subGrupo">
                  <option *ngFor="let subGrupo of subGrupos" [value]="subGrupo">{{ subGrupo }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Marca</label>
                <select [(ngModel)]="productoSeleccionado.marca" name="marca">
                  <option *ngFor="let marca of marcas" [value]="marca">{{ marca }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>C√≥digo de Barras 1</label>
                <input type="text" [(ngModel)]="productoSeleccionado.codigoBarras1" name="codigoBarras1">
              </div>
              <div class="form-group">
                <label>C√≥digo Com√∫n</label>
                <input type="text" [(ngModel)]="productoSeleccionado.codigoComun" name="codigoComun">
              </div>
            </fieldset>

            <!-- 2. Informaci√≥n Adicional -->
            <fieldset>
              <legend>Informaci√≥n Adicional</legend>
              <div class="form-group">
                <label>C√≥digo de Barras 2</label>
                <input type="text" [(ngModel)]="productoSeleccionado.codigoBarras2" name="codigoBarras2">
              </div>
              <div class="form-group">
                <label>C√≥digo de Barras 3</label>
                <input type="text" [(ngModel)]="productoSeleccionado.codigoBarras3" name="codigoBarras3">
              </div>
              <div class="form-group">
                <label>C√≥digo de Barras 4</label>
                <input type="text" [(ngModel)]="productoSeleccionado.codigoBarras4" name="codigoBarras4">
              </div>
              <div class="form-group">
                <label>C√≥digo de Barras 5</label>
                <input type="text" [(ngModel)]="productoSeleccionado.codigoBarras5" name="codigoBarras5">
              </div>
              <div class="form-group">
                <label>Stock M√≠nimo</label>
                <input type="number" [(ngModel)]="productoSeleccionado.stockMinimo" name="stockMinimo">
              </div>
              <div class="form-group">
                <label>Stock M√°ximo</label>
                <input type="number" [(ngModel)]="productoSeleccionado.stockMaximo" name="stockMaximo">
              </div>
              <div class="form-group">
                <label>Prote√≠nas</label>
                <input type="text" [(ngModel)]="productoSeleccionado.proteinas" name="proteinas">
              </div>
              <div class="form-group">
                <label>Calor√≠as</label>
                <input type="text" [(ngModel)]="productoSeleccionado.calorias" name="calorias">
              </div>
              <div class="form-group">
                <label>Unidad de Medida</label>
                <input type="text" [(ngModel)]="productoSeleccionado.unidadMedida" name="unidadMedida">
              </div>
              <div class="form-group">
                <label>Origen</label>
                <select [(ngModel)]="productoSeleccionado.origen" name="origen">
                  <option *ngFor="let origen of origenes" [value]="origen">{{ origen }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Fecha de Caducidad</label>
                <input type="date" [(ngModel)]="productoSeleccionado.fechaCaducidad" name="fechaCaducidad">
              </div>
              <div class="form-group">
                <label>Tiempo</label>
                <input type="text" [(ngModel)]="productoSeleccionado.tiempo" name="tiempo">
              </div>
              <div class="form-group">
                <label>Descuento</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.descuento" name="descuento" value="si"> S√≠</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.descuento" name="descuento" value="no"> No</label>
              </div>
              <div class="form-group">
                <label>Especificaciones</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.especificaciones" name="especificaciones" value="si"> S√≠</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.especificaciones" name="especificaciones" value="no"> No</label>
              </div>
            </fieldset>

            <!-- 3. Impuestos y Precios -->
            <fieldset>
              <legend>Impuestos y Precios</legend>
              <div class="form-group">
                <label>P.V.P.A</label>
                <input type="number" step="0.01" [(ngModel)]="productoSeleccionado.pvpa" name="pvpa">
              </div>
              <div class="form-group">
                <label>P.V.P.B</label>
                <input type="number" step="0.01" [(ngModel)]="productoSeleccionado.pvpb" name="pvpb">
              </div>
              <div class="form-group">
                <label>P.V.P.C</label>
                <input type="number" step="0.01" [(ngModel)]="productoSeleccionado.pvpc" name="pvpc">
              </div>
              <div class="form-group">
                <label>P.V.P.D</label>
                <input type="number" step="0.01" [(ngModel)]="productoSeleccionado.pvpd" name="pvpd">
              </div>
              <div class="form-group">
                <label>P.V.P.E</label>
                <input type="number" step="0.01" [(ngModel)]="productoSeleccionado.pvpe" name="pvpe">
              </div>
              <div class="form-group">
                <label>R√©gimen</label>
                <select [(ngModel)]="productoSeleccionado.regimen" name="regimen">
                  <option *ngFor="let regimen of regimenes" [value]="regimen">{{ regimen }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>ICE</label>
                <select [(ngModel)]="productoSeleccionado.ice" name="ice">
                  <option *ngFor="let ice of ices" [value]="ice">{{ ice }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Impuesto</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.impuesto" name="impuesto" value="iva0"> IVA - Tarifa Cero 0%</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.impuesto" name="impuesto" value="iva15"> IVA - Tarifa 15%</label>
                <label><input type="radio" [(ngModel)]="productoSeleccionado.impuesto" name="impuesto" value="no"> IVA - No objeto de impuestos</label>
              </div>
            </fieldset>

            <!-- 4. Cuentas -->
            <fieldset>
              <legend>Cuentas</legend>
              <div class="form-group">
                <label>Cta.Cont.Costo</label>
                <select [(ngModel)]="productoSeleccionado.ctaContCosto" name="ctaContCosto">
                  <option *ngFor="let cta of cuentas" [value]="cta">{{ cta }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Cta.Cont.Compras (debe)</label>
                <select [(ngModel)]="productoSeleccionado.ctaContCompras" name="ctaContCompras">
                  <option *ngFor="let cta of cuentas" [value]="cta">{{ cta }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Cta.Cont.Ventas (haber)</label>
                <select [(ngModel)]="productoSeleccionado.ctaContVentas" name="ctaContVentas">
                  <option *ngFor="let cta of cuentas" [value]="cta">{{ cta }}</option>
                </select>
              </div>
            </fieldset>

            <!-- Botones -->
            <div class="form-actions">
              <button type="button" class="btn-cancel" (click)="cancelarEdicion()">‚ùå Cancelar</button>
              <button type="submit" class="btn-save">{{ esEdicion ? 'üíæ Guardar Cambios' : '‚úÖ Agregar Producto' }}</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <!-- Enrutamiento de Angular -->
  <router-outlet></router-outlet>
</div>