<!-- Contenedor principal con ambos men√∫s y contenido -->
<div class="billing-admin-container">
  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Barra de navegaci√≥n superior ubicaci√≥n del usuario (breadcrumb) -->
    <div class="breadcrumb-container">
      <button>‚åÇ</button>
      <a (click)="navigateTo('Clientes')" class="breadcrumb-link">Clientes</a> /
      <span class="breadcrumb-current">Vista General</span>
    </div>

    <!-- Barra de b√∫squeda con selector de filtro y botones adicionales -->
    <div class="search-container">
      <select id="search-type" [(ngModel)]="searchType" (change)="cambiarTipoBusqueda()">
        <option value="cedula">C.I / RUC</option>
        <option value="nombre">Nombre</option>
        <option value="codigo">C√≥digo</option>
      </select>

      <input
        type="search"
        id="search-input"
        [(ngModel)]="searchValue"
        (input)="actualizarListaClientes()"
        placeholder="Buscar cliente..."
      />
      <button class="search-btn" (click)="actualizarListaClientes()">üîé</button>

      <div style="position: relative">
        <button class="column-toggle" (click)="toggleColumnas()">üìä</button>
        <div class="column-selector" [class.hidden]="!mostrarColumnas">
          <div class="column-list">
            <label *ngFor="let columna of columnasDisponibles">
              <input type="checkbox" [(ngModel)]="columna.selected" (change)="actualizarColumnas()"> {{ columna.name }}
            </label>
          </div>
        </div>
      </div>

      <button class="btn-export" (click)="exportarExcel()">üì• Excel</button>
      <button class="btn-import" (click)="navigateTo('Importar')">üìÇ Importar</button>
      <button class="btn-new-product" (click)="agregarCliente()">‚ûï Agregar Cliente</button>
    </div>

    <!-- Tabla de Clientes -->
    <div class="table-container">
      <table class="product-table" *ngIf="!mostrarFormularioEdicion">
        <thead>
          <tr>
            <th *ngFor="let columna of columnasVisibles">{{ columna.name }}</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientesPaginados">
            <td *ngFor="let columna of columnasVisibles">{{ cliente[columna.key] }}</td>
            <td>
              <button class="btn-edit" (click)="editarCliente(cliente)">‚úèÔ∏è</button>
              <button class="btn-delete" (click)="abrirModalEliminar(cliente)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <div class="pagination">
      <!-- Bot√≥n para seleccionar cantidad de √≠tems por p√°gina -->
      <div class="items-per-page">
        <label>Mostrar:</label>
        <select [(ngModel)]="itemsPorPagina" (change)="cambiarItemsPorPagina(itemsPorPagina)">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
      <button (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 1">Previa</button>
      <span>Mostrando del {{ (paginaActual - 1) * itemsPorPagina + 1 }} al {{ Math.min(paginaActual * itemsPorPagina, totalRegistros) }} registros de {{ totalRegistros }}</span>
      <button (click)="cambiarPagina(paginaActual + 1)" [disabled]="paginaActual * itemsPorPagina >= totalRegistros">Siguiente</button>
    </div>

    <!-- Modal para eliminar cliente -->
    <div class="modal-overlay" *ngIf="mostrarModalEliminar">
      <div class="modal-eliminar">
        <h2>Eliminar Cliente</h2>
        <p>¬øEst√°s seguro de que deseas eliminar este cliente?</p>
        <strong>{{ clienteAEliminar?.nombres }}</strong>
        <p>Esta acci√≥n har√° que el cliente ya no est√© disponible ni visible en el sistema.</p>
        <div class="modal-buttons">
          <button class="btn-cancel" (click)="cerrarModalEliminar()">Cancelar</button>
          <button class="btn-delete-confirm" (click)="eliminarCliente()">Eliminar Cliente</button>
        </div>
      </div>
    </div>

    <!-- Modal para el formulario de edici√≥n/creaci√≥n -->
    <div class="modal-overlay" *ngIf="mostrarFormularioEdicion">
      <div class="modal-formulario">
        <span class="close" (click)="cancelarEdicion()">&times;</span>
        <div class="formulario-edicion">
          <h2>{{ esEdicion ? 'Editar Cliente' : 'Agregar Cliente' }}</h2>
          <form (ngSubmit)="guardarCliente()">
            <!-- 1. Informaci√≥n B√°sica -->
            <fieldset>
              <legend>Informaci√≥n B√°sica</legend>
              <div class="form-group">
                <label>Tipo de Documento</label>
                <select [(ngModel)]="clienteSeleccionado.tipoDocumento" name="tipoDocumento" required>
                  <option value="CI/RUC">CI/RUC</option>
                  <option value="Pasaporte">Pasaporte</option>
                </select>
              </div>
              <div class="form-group">
                <label>Sujeto</label>
                <select [(ngModel)]="clienteSeleccionado.sujeto" name="sujeto" required>
                  <option value="Natural">Natural</option>
                  <option value="Jur√≠dica">Jur√≠dica</option>
                </select>
              </div>
              <div class="form-group">
                <label>Identificaci√≥n</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.identificacion" name="identificacion" required>
              </div>
              <div class="form-group">
                <label>Nombres</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.nombres" name="nombres" required>
              </div>
              <div class="form-group">
                <label>Apellidos</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.apellidos" name="apellidos" required>
              </div>
              <div class="form-group">
                <label>Direcci√≥n</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.direccion" name="direccion" required>
              </div>
              <div class="form-group">
                <label>Tipo de Cliente</label>
                <select [(ngModel)]="clienteSeleccionado.tipoCliente" name="tipoCliente" required>
                  <option *ngFor="let tipo of tiposCliente" [value]="tipo">{{ tipo }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Tel√©fono</label>
                <input type="tel" [(ngModel)]="clienteSeleccionado.telefono" name="telefono" required>
              </div>
              <div class="form-group">
                <label>Correo Electr√≥nico</label>
                <input type="email" [(ngModel)]="clienteSeleccionado.correo" name="correo" required>
              </div>
              <div class="form-group">
                <label>Correo Electr√≥nico 2</label>
                <input type="email" [(ngModel)]="clienteSeleccionado.correo2" name="correo2">
              </div>
            </fieldset>

            <!-- 2. Datos de Facturaci√≥n -->
            <fieldset>
              <legend>Datos de Facturaci√≥n</legend>
              <div class="form-group">
                <label>Raz√≥n Social</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.razonSocial" name="razonSocial">
              </div>
              <div class="form-group">
                <label>Establecimiento</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.establecimiento" name="establecimiento">
              </div>
              <div class="form-group">
                <label>Documento</label>
                <select [(ngModel)]="clienteSeleccionado.documento" name="documento">
                  <option value="Factura">Factura</option>
                  <option value="Nota de Venta">Nota de Venta</option>
                </select>
              </div>
              <div class="form-group">
                <label>Autorizaci√≥n del SRI</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.autorizacionSRI" name="autorizacionSRI">
              </div>
              <div class="form-group">
                <label>Punto de Emisi√≥n</label>
                <input type="text" [(ngModel)]="clienteSeleccionado.puntoEmision" name="puntoEmision">
              </div>
              <div class="form-group">
                <label>Fecha de Caducidad</label>
                <input type="date" [(ngModel)]="clienteSeleccionado.fechaCaducidad" name="fechaCaducidad">
              </div>
            </fieldset>

            <!-- 3. Datos Extras -->
            <fieldset>
              <legend>Datos Extras</legend>
              <div class="form-group">
                <label>Ingresos Mensuales</label>
                <input type="number" [(ngModel)]="clienteSeleccionado.ingresosMensuales" name="ingresosMensuales">
              </div>
              <div class="form-group">
                <label>Ciudad</label>
                <select [(ngModel)]="clienteSeleccionado.ciudad" name="ciudad">
                  <option *ngFor="let ciudad of ciudades" [value]="ciudad">{{ ciudad }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Cant√≥n</label>
                <select [(ngModel)]="clienteSeleccionado.canton" name="canton">
                  <option *ngFor="let canton of cantones" [value]="canton">{{ canton }}</option>
                </select>
              </div>
            </fieldset>

            <!-- 4. Retenciones -->
            <fieldset>
              <legend>Retenciones</legend>
              <div class="retenciones-search">
                <input type="text" placeholder="Buscar retenci√≥n..." [(ngModel)]="busquedaRetencion" name="busquedaRetencion" (input)="buscarRetencion()">
                <button type="button" (click)="buscarRetencion()">üîç Buscar</button>
              </div>
              <div class="retenciones-list">
                <label>Lista de Retenciones Disponibles</label>
                <ul>
                  <li *ngFor="let retencion of retencionesFiltradas">
                    {{ retencion.codigo }} - {{ retencion.descripcion }}
                    <button type="button" (click)="agregarRetencion(retencion)">‚ûï Agregar</button>
                  </li>
                </ul>
              </div>
              <div class="retenciones-list">
                <label>Retenciones Agregadas</label>
                <ul>
                  <li *ngFor="let retencion of clienteSeleccionado.retenciones">
                    {{ retencion.codigo }} - {{ retencion.descripcion }}
                    <button type="button" (click)="quitarRetencion(retencion)">‚ûñ Quitar</button>
                  </li>
                </ul>
              </div>
              <div class="retenciones-actions">
                <button type="button" (click)="pasarTodos()">Pasar Todos</button>
                <button type="button" (click)="quitarTodos()">Quitar Todos</button>
              </div>
            </fieldset>

            <!-- Botones de Acci√≥n -->
            <div class="form-actions">
              <button type="button" class="btn-cancel" (click)="cancelarEdicion()">‚ùå Cancelar</button>
              <button type="submit" class="btn-save">{{ esEdicion ? 'üíæ Guardar Cambios' : '‚úÖ Crear Cliente' }}</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>
</div>